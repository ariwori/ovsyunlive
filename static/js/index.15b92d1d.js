(function(e){function t(t){for(var n,a,i=t[0],c=t[1],u=t[2],l=0,d=[];l<i.length;l++)a=i[l],Object.prototype.hasOwnProperty.call(s,a)&&s[a]&&d.push(s[a][0]),s[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);p&&p(t);while(d.length)d.shift()();return o.push.apply(o,u||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],n=!0,a=1;a<r.length;a++){var i=r[a];0!==s[i]&&(n=!1)}n&&(o.splice(t--,1),e=c(c.s=r[0]))}return e}var n={},a={index:0},s={index:0},o=[];function i(e){return c.p+"js/"+({main:"main","pwa-electron":"pwa-electron",sentry:"sentry",welcome:"welcome","settings~users":"settings~users",settings:"settings",users:"users",share:"share",stream:"stream"}[e]||e)+"."+{main:"6a978b51","pwa-electron":"445fc57e",sentry:"3d076370",welcome:"29ff6863","settings~users":"c2cfa694",settings:"45b2be0f",users:"a9a65da0",share:"7c280b48",stream:"28095053"}[e]+".js"}function c(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,c),r.l=!0,r.exports}c.e=function(e){var t=[],r={main:1,welcome:1,"settings~users":1,settings:1,users:1,share:1,stream:1};a[e]?t.push(a[e]):0!==a[e]&&r[e]&&t.push(a[e]=new Promise((function(t,r){for(var n="css/"+({main:"main","pwa-electron":"pwa-electron",sentry:"sentry",welcome:"welcome","settings~users":"settings~users",settings:"settings",users:"users",share:"share",stream:"stream"}[e]||e)+"."+{main:"1473e1a7","pwa-electron":"31d6cfe0",sentry:"31d6cfe0",welcome:"18e82154","settings~users":"c08cfe8d",settings:"38e0cf9a",users:"6f376b33",share:"6dc43d7c",stream:"3ce876a1"}[e]+".css",s=c.p+n,o=document.getElementsByTagName("link"),i=0;i<o.length;i++){var u=o[i],l=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===n||l===s))return t()}var d=document.getElementsByTagName("style");for(i=0;i<d.length;i++){u=d[i],l=u.getAttribute("data-href");if(l===n||l===s)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var n=t&&t.target&&t.target.src||s,o=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=n,delete a[e],p.parentNode.removeChild(p),r(o)},p.href=s;var f=document.getElementsByTagName("head")[0];f.appendChild(p)})).then((function(){a[e]=0})));var n=s[e];if(0!==n)if(n)t.push(n[2]);else{var o=new Promise((function(t,r){n=s[e]=[t,r]}));t.push(n[2]=o);var u,l=document.createElement("script");l.charset="utf-8",l.timeout=120,c.nc&&l.setAttribute("nonce",c.nc),l.src=i(e);var d=new Error;u=function(t){l.onerror=l.onload=null,clearTimeout(p);var r=s[e];if(0!==r){if(r){var n=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;d.message="Loading chunk "+e+" failed.\n("+n+": "+a+")",d.name="ChunkLoadError",d.type=n,d.request=a,r[1](d)}s[e]=void 0}};var p=setTimeout((function(){u({type:"timeout",target:l})}),12e4);l.onerror=l.onload=u,document.head.appendChild(l)}return Promise.all(t)},c.m=e,c.c=n,c.d=function(e,t,r){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(c.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)c.d(r,n,function(t){return e[t]}.bind(null,n));return r},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/",c.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=t,u=u.slice();for(var d=0;d<u.length;d++)t(u[d]);var p=l;o.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"0a62":function(e,t,r){"use strict";r.d(t,"k",(function(){return c})),r.d(t,"f",(function(){return u})),r.d(t,"e",(function(){return l})),r.d(t,"b",(function(){return d})),r.d(t,"a",(function(){return p})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return m})),r.d(t,"g",(function(){return h})),r.d(t,"i",(function(){return v})),r.d(t,"h",(function(){return b})),r.d(t,"j",(function(){return g}));r("5319"),r("ac1f"),r("4d63"),r("25f0"),r("841c"),r("2b3d"),r("d3b7"),r("3ca3"),r("ddb0"),r("159b");var n=function(e,t,r,n,a,s,o){this.wsUri=e,this.logindata={},this.logindata.type="login",this.logindata.roomid=a,this.logindata.pid=554,this.logindata.user_name=t,this.logindata.nick_name=r,this.logindata.pass_word=n,this.logindata.mobile=2,this.logindata.state=0,this.logindata.level=s,this.logindata.vod="",this.logindata.avatar=o},a=5;n.prototype.connect=function(){var e=this;e.reconnectMs=2e3,e.wsmsg=new WebSocket(this.wsUri),e.wsmsg.onopen=function(t){e.wsmsg.send(JSON.stringify(e.logindata))},e.wsmsg.onerror=function(e){console.log("WsClient: onerror")},e.wsmsg.onmessage=function(t){var r;try{r=JSON.parse(t.data)}catch(s){return void console.log("This doesn't look like a valid JSON: ",t.data)}switch(r.type){case"adduserlist":break;case"login":var n={type:"get_top_list"};e.wsmsg.send(JSON.stringify(n));break;case"alert":break;case"state":break;case"on_hand":break;case"disconnect":break;case"public_message":break;case"system_message":break;case"Kick_out":break;case"online_list":break;case"on_addfile":n={type:"get_file_list"};e.wsmsg.send(JSON.stringify(n));break;case"on_delfile":n={type:"get_file_list"};e.wsmsg.send(JSON.stringify(n));case"get_file_list":break;case"set_topfile":break;case"get_top_list":break;case"draw_message":break;case"ovmeet_message":break;case"usermute":break;case"userhand":break;default:r.type="default";break}var a=new CustomEvent(r.type,{detail:r});e.wsmsg.dispatchEvent(a)},e.wsmsg.onclose=function(){console.log("WsClient: Connection closed "+a),a>0&&(setTimeout((function(){e.connect()}),2e3),a--);var t={type:"disconnect"};t.user_name=e.logindata.user_name;var r=new CustomEvent(t.type,{detail:t});e.wsmsg.dispatchEvent(r)}},n.prototype.disconnect=function(){this.reconnt=0,this.wsmsg.close()},n.prototype.send=function(e){this.wsmsg.send(JSON.stringify(e))};var s=function(e,t,r,n,a){var s=new XMLHttpRequest;s.onreadystatechange=function(){4===s.readyState&&n(s.responseText)};var i=o(a,t);s.open(e,i,!0),s.setRequestHeader("Content-Type","application/json"),void 0!==r?s.send(JSON.stringify(r)):s.send()};var o=function(e,t){var r;if(void 0!==e)r=e+t;else{var n="https://"+location.host+"/",a=new URL(n);r=a.origin+t}return r},i=function(e){e||console.info("Null")};function c(e,t,r,a){var s="wss://"+window.location.host,o=t,i=r,c="1234",u="avatar.png",l=a,d=new n(s,o,i,c,e,l,u);return d.connect(),d}function u(e,t,r,n,a,o){s("GET","/setusermute/"+e+"/"+t+"/"+r+"/"+n,(function(e){a(e)}),o)}function l(e,t,r,n,a){s("GET","/setuserhand/"+e+"/"+t+"/"+r,(function(e){n(e)}),a)}function d(e,t,r,n,a,o){s("GET","/killuser/"+e+"/"+n,(function(e){a(e)}),o)}function p(e,t,r,n){s("DELETE","/stopstreamin/"+e+"/"+r,i,n)}function f(e,t,r,n){var a=[];a.push({op:"replace",path:"/info/layout/0/stream",value:t}),s("PATCH","/rooms/"+e+"/streams/"+r,a,i,n)}function m(e,t,r,n){var a=[];r.forEach((function(e){a.push({op:"replace",path:"/info/layout",value:e})})),s("PATCH","/rooms/"+e+"/streams/"+t,a,i,n)}function h(e,t,r,n,a,o){var i={name:t,custompath:r,loop:1,auto:1,tasks:[{explain:t,transtype:n,src:e}]};s("POST","/api/push/add/",i,a,o)}function v(e,t,r){var n=e,a={address:encodeURI(n)};s("POST","/api/push/remove/",a,t,r)}function b(e,t,r){s("GET","/sig/pubstart/?app="+e+"&stream="+t,void 0,i,r)}function g(e,t,r){s("GET","/sig/pubstop/?app="+e+"&stream="+t,void 0,i,r)}},"0ab5":function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"c",(function(){return s})),r.d(t,"b",(function(){return o}));var n=r("53ca");r("13d5"),r("4de4"),r("b64b"),r("159b"),r("99af"),r("caad"),r("d3b7"),r("25f0");function a(e){try{return"object"===Object(n["a"])(e)?JSON.parse(JSON.stringify(e)):e}catch(t){log("cloneObject error:",t)}return null}function s(e,t){var r=function(e){return e&&"object"===Object(n["a"])(e)};return r(e)&&r(t)?(Object.keys(t).forEach((function(n){var a=e[n],o=t[n];Array.isArray(a)&&Array.isArray(o)?e[n]=a.concat(o):r(a)&&r(o)?e[n]=s(Object.assign({},a),o):e[n]=o})),e):t}function o(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return null==e?t:["1","true","yes"].includes(e.toString().toLocaleLowerCase())}},"28b0":function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return d})),r.d(t,"d",(function(){return p}));r("d3b7"),r("3ca3"),r("ddb0");var n=r("2b0e"),a=r("db49"),s=r("a23e"),o=r("34eb")("app:bugs");function i(e){a["c"]&&a["g"]&&u()&&(console.log("Sentry bug tracking is allowed"),r.e("sentry").then(r.bind(null,"011e")).then((function(t){var r=t.setupSentry;r({dsn:a["g"],Vue:n["default"]}),console.log("Did init Sentry bug tracking"),e&&e()})))}var c=[];function u(){var e;return"1"===(null===(e=localStorage)||void 0===e?void 0:e.allowSentry)}function l(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Reload to activate changes";o("setAllowedBugTracking",e),e?(localStorage.allowSentry="1",i((function(e){var t;o("setupBugTracker",c);while(t=c.pop())o("send error",t),d(t)}))):(localStorage.allowSentry="0",confirm(t)&&location.reload())}function d(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t||console.error("Exception:",e),window.sentry?(o("sentry exception",e),window.sentry.captureException(e)):(c.push(e),s["b"].emit("requestBugTracking"))}function p(e){console.error(e),d(e,!0)}},"34bb":function(e,t){e.exports=require("electron")},3504:function(e){e.exports=JSON.parse('{"welcome":{"start":"开始聊天","abstract":"安全的点对点的群组聊天工具","help":"了解更多","created":"作者:"},"share":{"title":"邀请","link_info":"请您通过此链接邀请参加此会议的所有人：","button_copy":"分享","qr_info":"您也可以使用移动设备摄像头扫描此二维码：","feedback":"有问题请反馈到<a href=\\"mailto:1410919373@qq.com\\">1410919373@qq.com</a>","message":"通过按下 $symbol$ 来发送邀请朋友加入群聊"},"settings":{"title":"设置","video":"视频来源","audio":"音频来源","desktop":"共享屏幕或窗口","blur":"模糊背景","blur_info":"实验性的：一种智能的人工智能算法能够识别人的形状，并模糊掉其余的背景。这为您的通话增加了一些视觉隐私。但是请注意，这是一个非常耗电的功能，很可能无法在移动设备上使用！ ","bandwidth":"应用带宽优化 ","bandwidth_info":"实验性：使用此设置，“简报”尝试通过稀疏视频和音频数据来减少带宽。 ","fill":"放大视频","fill_info":"简报试图通过以使视频适合其视觉框架的方式缩放视频来尽可能地利用可用的屏幕空间。关闭后，您会看到整个视频，但周围带有边框。","subscribe":"订阅这个房间","subscribe_info":"实验性的：通过订阅，当其他人进入这个房间时，您会收到通知。然后，您可以一键加入对话。仅在浏览器正在运行时显示通知。 ","sentry":"允许错误跟踪","sentry_info":"当遇到编程错误或其他对改善应用程序有用的相关信息时，我们会将调试数据发送到<a href=\\"https://www.ovsyun.com\\">www.ovsyun.com</a>.","sentry_confirm":"感谢您允许错误跟踪。请确认立即重新加载页面。","background":"背景","persist_settings":"持续设置","original_background":"原始背景","blurred_background":"模糊背景","image_background":"图片背景","image_tip":"您可以通过在此窗口上拖动图像文件来上传自己的背景。","random_image":"单击以获取另一个随机图像。"}}')},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d"),r("d3b7"),r("3ca3"),r("ddb0"),r("466d"),r("ac1f");var n=r("2b0e"),a=(r("db49"),r("0ab5"));function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.lang,r=e.locales,n=void 0===r?{en:{}}:r,s=e.defaultLang,o=void 0===s?"zh":s;return t="zh",Object(a["c"])(Object(a["c"])({},n[o]),n[t]||{})}var o,i,c,u,l={install:function(e,t){e.mixin({data:function(){return{l:s(t)}}})}},d=r("3504"),p=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null==e.state.room?r("app-welcome",{staticClass:"app"}):r("app-main")},f=[],m=r("34eb")("app:pwa-app"),h={name:"App",components:{AppWelcome:function(){return r.e("welcome").then(r.bind(null,"ee5b"))},AppMain:function(){return r.e("main").then(r.bind(null,"8cd5"))}},data:function(){return{}},mounted:function(){m("pwa")}},v=h,b=(r("74f5"),r("2877")),g=Object(b["a"])(v,p,f,!1,null,null,null),_=g.exports,w=r("faae"),y=r("5c96"),S=r.n(y);r("0fae");n["default"].use(S.a),navigator.userAgent.toLowerCase().indexOf(" electron/")>-1&&null==window.beaker&&(console.log("Identified Electron"),r.e("pwa-electron").then(r.bind(null,"0f3b")).then(),console.log("Handled Electron")),window.iOS=null!=(null===(o=navigator)||void 0===o||null===(i=o.platform)||void 0===i?void 0:i.match(/(iPhone|iPod|iPad)/i)),window.iPhone=null!=(null===(c=navigator)||void 0===c||null===(u=c.platform)||void 0===u?void 0:u.match(/(iPhone|iPod)/i)),window.iPhone&&console.log("Identified Phone of a native app"),n["default"].config.productionTip=!1,n["default"].mixin({data:function(){return{state:w["b"]}},methods:{openExternalLink:function(e){if(window.electron){var t;if("string"===typeof e)t=e;else{var r,n=null===e||void 0===e?void 0:e.target;while(n&&null==(null===(a=n)||void 0===a?void 0:a.href)){var a;n=n.parentElement}t=null===(r=n)||void 0===r?void 0:r.href}return console.info("Open external link",e.target),t&&window.electron.shell.openExternal(t),e.preventDefault(),!1}return!0}}}),n["default"].use(l,{locales:{zh:d}}),new n["default"]({render:function(e){return e(_)}}).$mount("#app")},"74f5":function(e,t,r){"use strict";r("95df")},"95df":function(e,t,r){},a23e:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return u}));var n=r("d4ec"),a=r("bee2"),s=r("ade3"),o=(r("4de4"),r("28b0")),i=r("34eb")("app:emitter"),c=function(){function e(){Object(n["a"])(this,e),Object(s["a"])(this,"subscribers",{})}return Object(a["a"])(e,[{key:"emit",value:function(e,t){try{for(var r=this.subscribers[e]||[],n=0;n<r.length;n++){var a=r[n];try{a(t)}catch(s){console.warn("emit warning:",s),Object(o["d"])(s)}}}catch(s){console.error("emit exception",s),Object(o["d"])(s)}}},{key:"on",value:function(e,t){var r=this,n=this.subscribers[e]||[];return n.push(t),this.subscribers[e]=n,{cleanup:function(){r.off(e,t)}}}},{key:"off",value:function(e,t){i("off",e),this.subscribers=(this.subscribers[e]||[]).filter((function(e){return t&&e!==t}))}}]),e}(),u=new c},db49:function(e,t,r){"use strict";r.d(t,"n",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return o})),r.d(t,"c",(function(){return i})),r.d(t,"d",(function(){return c})),r.d(t,"g",(function(){return u})),r.d(t,"f",(function(){return l})),r.d(t,"e",(function(){return d})),r.d(t,"h",(function(){return p})),r.d(t,"i",(function(){return f})),r.d(t,"j",(function(){return m})),r.d(t,"k",(function(){return h})),r.d(t,"l",(function(){return v})),r.d(t,"m",(function(){return b}));var n=r("0ab5"),a="wss://192.168.1.199:4444",s={iceTransportPolicy:"all",reconnectTimer:3e3,iceServers:[{urls:"stun:49.12.77.1:5349"},{urls:"turn:49.12.77.1:5349",username:"brie",credential:"fi"}]},o=!1,i=!o,c="ViMeet@2.19.6",u="",l="https://"+location.host+"/?room=",d=Object({NODE_ENV:"production",VUE_APP_AUTHOR_EMAIL:"dirk.holtwick@gmail.com",VUE_APP_AUTHOR_NAME:"Dirk Holtwick",VUE_APP_DEBUG_DEFAULT_ROOM:"development",VUE_APP_NAME:"ViMeet",VUE_APP_RELEASE:"ViMeet@2.19.6",VUE_APP_SENTRY_DSN:"",VUE_APP_SHOW_FULLSCREEN:"1",VUE_APP_SHOW_INVITATION:"1",VUE_APP_SHOW_INVITATION_HINT:"1",VUE_APP_SHOW_SETTINGS:"1",VUE_APP_SHOW_SHARE:"1",VUE_APP_SIGNAL_URL:"wss://192.168.1.199:4444",VUE_APP_STUN_URL:"stun:49.12.77.1:5349",VUE_APP_TURN_PASSWORD:"fi",VUE_APP_TURN_URL:"turn:49.12.77.1:5349",VUE_APP_TURN_USER:"brie",VUE_APP_UNSPLASH_API:"",VUE_APP_UNSPLASH_SECRET:"",VUE_APP_VERSION:"2.19.6",BASE_URL:"/"}).VUE_APP_ROOM_PATH||"/vvvv/",p=Object(n["b"])("1",!0),f=Object(n["b"])("1",!0),m=Object(n["b"])("1",!0),h=Object(n["b"])("1",!0),v=Object(n["b"])("1",!0),b=Object(n["b"])(Object({NODE_ENV:"production",VUE_APP_AUTHOR_EMAIL:"dirk.holtwick@gmail.com",VUE_APP_AUTHOR_NAME:"Dirk Holtwick",VUE_APP_DEBUG_DEFAULT_ROOM:"development",VUE_APP_NAME:"ViMeet",VUE_APP_RELEASE:"ViMeet@2.19.6",VUE_APP_SENTRY_DSN:"",VUE_APP_SHOW_FULLSCREEN:"1",VUE_APP_SHOW_INVITATION:"1",VUE_APP_SHOW_INVITATION_HINT:"1",VUE_APP_SHOW_SETTINGS:"1",VUE_APP_SHOW_SHARE:"1",VUE_APP_SIGNAL_URL:"wss://192.168.1.199:4444",VUE_APP_STUN_URL:"stun:49.12.77.1:5349",VUE_APP_TURN_PASSWORD:"fi",VUE_APP_TURN_URL:"turn:49.12.77.1:5349",VUE_APP_TURN_USER:"brie",VUE_APP_UNSPLASH_API:"",VUE_APP_UNSPLASH_SECRET:"",VUE_APP_VERSION:"2.19.6",BASE_URL:"/"}).VUE_APP_SHOW_USERS,!0)},faae:function(e,t,r){"use strict";r.d(t,"b",(function(){return O})),r.d(t,"a",(function(){return C}));var n=r("5530"),a=r("1da1"),s=(r("96cf"),r("2b3d"),r("d3b7"),r("3ca3"),r("ddb0"),r("841c"),r("ac1f"),r("4ec9"),r("cb29"),r("a434"),r("d81d"),r("159b"),r("a23e"));r("25f0"),r("a9e3"),r("1276"),r("5319");function o(){var e={};return e.connect=function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(r,n,a,s){var o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=r+"://"+n+"/sig/v1/rtc",e.ws=new WebSocket(o+"?room="+a+"&display="+s),e.ws.onmessage=function(t){var r=JSON.parse(t.data),n=e._internals.msgs[r.tid];n?(n.resolve(r.msg),delete e._internals.msgs[r.tid]):e.onmessage(r.msg)},t.abrupt("return",new Promise((function(t,r){e.ws.onopen=function(e){t(e)},e.ws.onerror=function(e){r(e)}})));case 4:case"end":return t.stop()}}),t)})));return function(e,r,n,a){return t.apply(this,arguments)}}(),e.send=function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(r){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){var a={tid:Number(parseInt((new Date).getTime()*Math.random()*100)).toString(16).substr(0,7),msg:r};e._internals.msgs[a.tid]={resolve:t,reject:n},e.ws.send(JSON.stringify(a))})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.close=function(){for(var t in e.ws&&e.ws.close(),e.ws=null,e._internals.msgs){var r=e._internals.msgs[t];r.reject("close")}},e.onmessage=function(e){},e._internals={msgs:{}},e}r("a15b");function i(){var e={};return e.publish=function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(r,n){var a,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.__internal.prepareUrl(r),n.getTracks().forEach((function(t){e.pc.addTrack(t)})),s={offerToReceiveAudio:1,offerToReceiveVideo:1},t.next=5,e.pc.createOffer(s).then((function(t){e.pc.setLocalDescription(t).then((function(){axios({method:"post",url:a.apiUrl,responseType:"json",data:t.sdp,headers:{"Content-Type":"text/plain;charset=utf-8"}}).then((function(t){var r=t.data;if(0==r.code){var n={};n.sdp=r.sdp,n.type="answer",e.pc.setRemoteDescription(n).then((function(){console.log("set remote sucess");var t=new CustomEvent("PUBLISH",{detail:""});e.pc.dispatchEvent(t)})).catch((function(e){console.error(e)}))}}))}))})).catch((function(e){console.error(e)}));case 5:return t.abrupt("return",e.pc);case 6:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),e.close=function(){e.pc&&e.pc.close(),e.pc=null},e.onaddstream=function(e){},e.__internal={defaultPath:"/index/api/",prepareUrl:function(t){var r=e.__internal.parse(t),n=r.user_query.schema;n=n?n+":":window.location.protocol;var a=r.port||1985;"https:"===n&&(a=r.port||443);var s=r.user_query.play||e.__internal.defaultPath;for(var o in s.lastIndexOf("/")!==s.length-1&&(s+="/"),i=n+"//"+r.server+":"+a+s+"webrtc?app="+r.app+"&stream="+r.stream+"&type=push",r.user_query)"api"!==o&&"play"!==o&&(i+="&"+o+"="+r.user_query[o]);var i=i.replace(s+"&",s+"?"),c=r.url;return{apiUrl:i,streamUrl:c,schema:n,urlObject:r,port:a,tid:Number(parseInt((new Date).getTime()*Math.random()*100)).toString(16).substr(0,7)}},parse:function(t){var r=document.createElement("a");r.href=t.replace("rtmp://","http://").replace("webrtc://","http://").replace("rtc://","http://");var n=r.hostname,a=r.pathname.substr(1,r.pathname.lastIndexOf("/")-1),s=r.pathname.substr(r.pathname.lastIndexOf("/")+1);if(a=a.replace("...vhost...","?vhost="),a.indexOf("?")>=0){var o=a.substr(a.indexOf("?"));a=a.substr(0,a.indexOf("?")),o.indexOf("vhost=")>0&&(n=o.substr(o.indexOf("vhost=")+"vhost=".length),n.indexOf("&")>0&&(n=n.substr(0,n.indexOf("&"))))}if(r.hostname===n){var i=/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/;i.test(r.hostname)&&(n="__defaultVhost__")}var c="rtmp";t.indexOf("://")>0&&(c=t.substr(0,t.indexOf("://")));var u=r.port;u||("http"===c?u=80:"https"===c?u=443:"rtmp"===c&&(u=1935));var l={url:t,schema:c,server:r.hostname,port:u,vhost:n,app:a,stream:s};return e.__internal.fill_query(r.search,l),l.port||"webrtc"!==c&&"rtc"!==c||("https"===l.user_query.schema||0===window.location.href.indexOf("https://")?l.port=443:l.port=1985),l},fill_query:function(e,t){if(t.user_query={},0!==e.length){e.indexOf("?")>=0&&(e=e.split("?")[1]);for(var r=e.split("&"),n=0;n<r.length;n++){var a=r[n],s=a.split("=");t[s[0]]=s[1],t.user_query[s[0]]=s[1]}t.domain&&(t.vhost=t.domain)}}},e.pc=new RTCPeerConnection(null),e}function c(){var e={};return e.play=function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(r){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.__internal.prepareUrl(r),a={offerToReceiveAudio:1,offerToReceiveVideo:1},t.next=4,e.pc.createOffer(a);case 4:return t.sent,t.next=7,e.pc.createOffer(a).then((function(t){e.pc.setLocalDescription(t).then((function(){e.ttttt2=setInterval((function(){axios({method:"post",url:n.apiUrl,responseType:"json",data:t.sdp,headers:{"Content-Type":"text/plain;charset=utf-8"}}).then((function(t){var r=t.data;if(0==r.code){clearInterval(e.ttttt2);var n={};n.sdp=r.sdp,n.type="answer",e.pc.setRemoteDescription(n).then((function(){console.log("set PLAY remote sucess")})).catch((function(e){console.error(e)}))}}))}),2e3)})).catch((function(e){console.error(e)}))}));case 7:return t.abrupt("return",e.pc);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.close=function(){e.pc&&e.pc.close(),e.pc=null,e.ttttt2&&clearInterval(e.ttttt2)},e.onaddstream=function(e){},e.__internal={defaultPath:"/index/api/",prepareUrl:function(t){var r=e.__internal.parse(t),n=r.user_query.schema;n=n?n+":":window.location.protocol;var a=r.port||1985;"https:"===n&&(a=r.port||443);var s=r.user_query.play||e.__internal.defaultPath;for(var o in s.lastIndexOf("/")!==s.length-1&&(s+="/"),i=n+"//"+r.server+":"+a+s+"webrtc?app="+r.app+"&stream="+r.stream+"&type=play",r.user_query)"api"!==o&&"play"!==o&&(i+="&"+o+"="+r.user_query[o]);var i=i.replace(s+"&",s+"?"),c=r.url;return{apiUrl:i,streamUrl:c,schema:n,urlObject:r,port:a,tid:Number(parseInt((new Date).getTime()*Math.random()*100)).toString(16).substr(0,7)}},parse:function(t){var r=document.createElement("a");r.href=t.replace("rtmp://","http://").replace("webrtc://","http://").replace("rtc://","http://");var n=r.hostname,a=r.pathname.substr(1,r.pathname.lastIndexOf("/")-1),s=r.pathname.substr(r.pathname.lastIndexOf("/")+1);if(a=a.replace("...vhost...","?vhost="),a.indexOf("?")>=0){var o=a.substr(a.indexOf("?"));a=a.substr(0,a.indexOf("?")),o.indexOf("vhost=")>0&&(n=o.substr(o.indexOf("vhost=")+"vhost=".length),n.indexOf("&")>0&&(n=n.substr(0,n.indexOf("&"))))}if(r.hostname===n){var i=/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/;i.test(r.hostname)&&(n="__defaultVhost__")}var c="rtmp";t.indexOf("://")>0&&(c=t.substr(0,t.indexOf("://")));var u=r.port;u||("http"===c?u=80:"https"===c?u=443:"rtmp"===c&&(u=1935));var l={url:t,schema:c,server:r.hostname,port:u,vhost:n,app:a,stream:s};return e.__internal.fill_query(r.search,l),l.port||"webrtc"!==c&&"rtc"!==c||("https"===l.user_query.schema||0===window.location.href.indexOf("https://")?l.port=443:l.port=1985),l},fill_query:function(e,t){if(t.user_query={},0!==e.length){e.indexOf("?")>=0&&(e=e.split("?")[1]);for(var r=e.split("&"),n=0;n<r.length;n++){var a=r[n],s=a.split("=");t[s[0]]=s[1],t.user_query[s[0]]=s[1]}t.domain&&(t.vhost=t.domain)}}},e.pc=new RTCPeerConnection(null),e.pc.onaddstream=function(t){e.onaddstream&&e.onaddstream(t)},e}var u=r("0a62"),l=(r("a630"),r("b0c0"),r("28b0")),d=r("34eb")("app:stream");function p(){return f.apply(this,arguments)}function f(){return f=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",navigator.mediaDevices.enumerateDevices());case 4:e.prev=4,e.t0=e["catch"](0),Object(l["d"])(e.t0);case 7:return e.abrupt("return",[]);case 8:case"end":return e.stop()}}),e,null,[[0,4]])}))),f.apply(this,arguments)}var m={video:{width:640}},h={echoCancellation:!0,noiseSuppression:!0};function v(e){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)return navigator.mediaDevices.getUserMedia(e);var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return new Promise((function(r,n){t?t.call(navigator,e,r,n):n(new Error("Video and audio cannot be accessed. Please try again with another browser or check your browser's settings."))}))}function b(){return g.apply(this,arguments)}function g(){return g=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r,a,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{audio:Object(n["a"])({},h),video:Object(n["a"])(Object(n["a"])({},m),{},{facingMode:"user"})},e.prev=1,d("getUserMedia constraints",t),e.next=5,v(t);case 5:return r=e.sent,e.abrupt("return",{stream:r});case 9:if(e.prev=9,e.t0=e["catch"](1),a=(null===e.t0||void 0===e.t0?void 0:e.t0.name)||(null===e.t0||void 0===e.t0?void 0:e.t0.toString()),"NotAllowedError"!==a){e.next=16;break}return e.abrupt("return",{error:"You denied access to your camera and microphone. Please check your setup."});case 16:if("NotFoundError"!==a){e.next=18;break}return e.abrupt("return",{error:"No camera or microphone has been found!"});case 18:return Object(l["c"])(e.t0),e.abrupt("return",{error:(null===e.t0||void 0===e.t0?void 0:e.t0.message)||(null===e.t0||void 0===e.t0?void 0:e.t0.name)||e.t0.toString()});case 20:case"end":return e.stop()}}),e,null,[[1,9]])}))),g.apply(this,arguments)}function _(e,t){return Array.from(e.getAudioTracks()).forEach((function(t){return e.removeTrack(t)})),t.forEach((function(t){try{e.addTrack(t)}catch(r){"Track has already been added to that stream."!==(null===r||void 0===r?void 0:r.message)&&Object(l["d"])(r)}})),e}var w=r("db49");r("34eb")("app:iframe");for(var y=r("0ab5"),S=r("34eb")("app:state"),E=!1,P=(Object({NODE_ENV:"production",VUE_APP_AUTHOR_EMAIL:"dirk.holtwick@gmail.com",VUE_APP_AUTHOR_NAME:"Dirk Holtwick",VUE_APP_DEBUG_DEFAULT_ROOM:"development",VUE_APP_NAME:"ViMeet",VUE_APP_RELEASE:"ViMeet@2.19.6",VUE_APP_SENTRY_DSN:"",VUE_APP_SHOW_FULLSCREEN:"1",VUE_APP_SHOW_INVITATION:"1",VUE_APP_SHOW_INVITATION_HINT:"1",VUE_APP_SHOW_SETTINGS:"1",VUE_APP_SHOW_SHARE:"1",VUE_APP_SIGNAL_URL:"wss://192.168.1.199:4444",VUE_APP_STUN_URL:"stun:49.12.77.1:5349",VUE_APP_TURN_PASSWORD:"fi",VUE_APP_TURN_URL:"turn:49.12.77.1:5349",VUE_APP_TURN_USER:"brie",VUE_APP_UNSPLASH_API:"",VUE_APP_UNSPLASH_SECRET:"",VUE_APP_VERSION:"2.19.6",BASE_URL:"/"}).VUE_APP_TARGET,new URLSearchParams(window.location.search)),O={room:"",localStream:null,status:{},users:[],peers:[],bandwidth:!1,fill:!0,backgroundMode:"",backgroundImageURL:null,backgroundAuthor:"",backgroundURL:"",ishand:!1,muteVideo:!Object(y["b"])(P.get("video"),!0),muteAudio:!Object(y["b"])(P.get("audio"),!0),mcu:Object(y["b"])(P.get("mcu"),!1),deviceVideo:null,deviceAudio:null,devices:[],svg:{stroke:"1.5"},maximized:"",vapidPublicKey:null,error:null,upgrade:!1,requestBugTracking:!1,embedDemo:!1,showInviteOnStart:Object(y["b"])(P.get("invite"),w["i"]),showInviteHint:Object(y["b"])(P.get("invite"),w["j"]),showFullscreen:Object(y["b"])(P.get("fs"),w["h"]),showSettings:Object(y["b"])(P.get("prefs"),w["k"]),showShare:Object(y["b"])(P.get("share"),w["l"]),showUsers:Object(y["b"])(P.get("users"),w["m"]),sipserver:"",sipusername:"",sippassword:"",apiserver:location.hostname,showWbb:Object(y["b"])(P.get("wbb"),!1),screenshots:E,forwardStreamMap:new Map,refreshMute:null,conference:null,publicationGlobal:null,userListwin:!1,isMaximized:!1,myRoom:"",myUserId:"",myUserNick:"",passWord:"",level:"1",shareVideoUrl:"",shareVideoStream:null,statUpload:0,statDownload:0,playerStream:null,isSpeakMuted:!1,isMicMuted:!1,isCameraMuted:!1,isCamera2Muted:!1,isDesktopShared:!1,isRecordStarted:!1,usedMicrophone:"",usedCamera:"",usedCamera2:"",usedCamera2DeviceId:"",layoutIndex:0,msg_input_visible:!1,msg_content:"",emoji_visible:!1,emoji_data:["emoji_5","emoji_6","emoji_7","emoji_4","emoji_0","emoji_1","emoji_2","emoji_3"],screen_data:[],screen_select_visible:!1,lastMoveTime:0,hideCursorIntervalHandle:null,tools_visible:!0,tools_hover:!1,participants:[],remoteStreams:[],peerConnectionScreen:null,userlist:[]},U=0;U<6;U++)Math.floor(10*Math.random());function A(){try{O.localStream?(O.localStream.getVideoTracks()[0].enabled=!O.muteVideo,O.localStream.getAudioTracks()[0].enabled=!O.muteAudio,O.muteAudio&&O.muteVideo&&T()):O.muteAudio&&O.muteVideo||V()}catch(e){Object(l["c"])(e),console.error("trackException------------"+e)}}function k(){alert("成功！")}function R(){return I.apply(this,arguments)}function I(){return I=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,T();case 2:return e.next=4,V();case 4:case"end":return e.stop()}}),e)}))),I.apply(this,arguments)}function T(){return x.apply(this,arguments)}function x(){return x=Object(a["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,O.conference.send({action:"unpublish",room:O.myRoom,display:O.myUserId});case 2:t=e.sent,console.log("unPublishVideo: unpublish ok",t),F();case 5:case"end":return e.stop()}}),e)}))),x.apply(this,arguments)}function V(){return j.apply(this,arguments)}function j(){return j=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r,a,s,o,i,c,u,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=Object(n["a"])({},h),O.deviceAudio&&(t.deviceId=O.deviceAudio),r=Object(n["a"])({},m),c&&(r=Object(n["a"])({},defaultScreenConstraints)),O.deviceVideo&&(r.deviceId=O.deviceVideo),a={audio:t,video:r},c="desktop"===O.deviceVideo,!c){e.next=20;break}return e.next=10,navigator.mediaDevices.getDisplayMedia(a);case 10:return o=e.sent,delete a.video,e.next=14,b(a);case 14:i=e.sent,u=i.stream.getAudioTracks(),o&&(_(o,u),s=o),O.isDesktopShared=!0,e.next=26;break;case 20:return e.next=22,b(a);case 22:i=e.sent,O.error=i.error,s=i.stream,O.isDesktopShared=!1;case 26:return e.next=28,G(O.apiserver+":8806",O.myRoom,O.myUserId,s);case 28:return e.next=30,O.conference.send({action:"publish",room:O.myRoom,display:O.myUserId});case 30:l=e.sent,console.log("publishVideo: publish ok",l);case 32:case"end":return e.stop()}}),e)}))),j.apply(this,arguments)}O.myRoomId=O.myRoom=O.room=P.get("roomid")?P.get("roomid"):"5ffe1d7babd85a0fa64755f8",P.get("username")||(location.href="./login.html"),O.myUserId=P.get("username"),O.myUserNick=O.myUserId,O.sipserver="rtmp://127.0.0.1:1937/live/"+O.myUserId,O.passWord=P.get("password")?P.get("password"):"1234",P.get("level")&&"on"==P.get("level")?O.level=0:O.level=1,O.mcu&&(O.fill=!1),s["b"].on("requestBugTracking",(function(e){return O.requestBugTracking=!0})),s["b"].on("upgrade",(function(e){return O.upgrade=!0})),s["b"].on("updateStream",A),s["b"].on("setSipUser",k),s["b"].on("switchMedia",R);function N(e){for(var t=0,r=0;r<O.users.length;++r)if(O.users[r]&&O.users[r].id===e){t=r;break}O.users[t].userId==O.myUserId&&alert("kill me!"),O.users.splice(t,1)}function L(e){for(var t=0,r=0;r<O.peers.length;++r)if(O.peers[r]&&O.peers[r].userId===e){t=r,O.peers[r].player.close();break}O.peers[t].userId==O.myUserId&&alert("kill me peer!"),O.peers.splice(t,1)}function M(e){for(var t=0;t<O.userlist.length;++t)if(O.userlist[t]&&O.userlist[t].user_name===e)return O.userlist[t].ishand;return!1}function H(e){for(var t=0;t<O.userlist.length;++t)if(O.userlist[t]&&O.userlist[t].user_name===e)return O.userlist[t].muteaudio;return!1}function D(e){for(var t=0;t<O.userlist.length;++t)if(O.userlist[t]&&O.userlist[t].user_name===e)return O.userlist[t].mutevideo;return!1}function C(){O.isMicMuted=!0,O.isCameraMuted=!0,O.isCamera2Muted=!0,O.isDesktopShared=!1,O.isRecordStarted=!1,O.wsclient=Object(u["k"])(O.myRoom,O.myUserId,O.myUserNick,O.level),O.wsclient.wsmsg.addEventListener("login",function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r,n,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.detail.user_name==O.myUserId&&(O.userlist=t.detail.userlist),console.log(O.myRoom,"------",O.myUserId,O.level),O.conference=new o,O.conference.onmessage=function(e){e.peer.display!==O.myUserId&&("publish"===e.event&&e.peer&&e.peer.publishing&&q(O.apiserver+":8806",O.myRoom,e.peer.display),"unpublish"===e.event&&L(e.peer.display),"control"===e.event&&"message"===e.param&&(e.data=JSON.parse(e.data),"msg_text"!=e.data.type&&"msg_emoji"!=e.data.type||(e.data.userId=e.peer.display,s["b"].emit("sendMessage",e.data))),"join"===e.event&&O.users.push({id:e.peer.display,userId:e.peer.display,nackname:e.peer.display==O.myUserId?e.peer.display+"(本人)":e.peer.display,level:e.peer.level,ishand:M(e.peer.display),muteaudio:H(e.peer.display),mutevideo:D(e.peer.display),shareScreenStream:!1}),"leave"===e.event&&(N(e.peer.display),L(e.peer.display)))},e.next=6,O.conference.connect("wss",O.apiserver+":8806",O.myRoom,O.myUserId);case 6:return e.next=8,O.conference.send({action:"join",room:O.myRoom,display:O.myUserId});case 8:return r=e.sent,e.next=11,b();case 11:if(n=e.sent,a=n.stream,i=n.error,O.error=i,!a){e.next=24;break}return e.next=18,p();case 18:if(e.t0=e.sent,e.t0){e.next=21;break}e.t0=[];case 21:O.devices=e.t0.map((function(e){var t;return S("found device",e),{kind:(null===e||void 0===e||null===(t=e.kind)||void 0===t?void 0:t.toLowerCase())||"?",deviceId:null===e||void 0===e?void 0:e.deviceId,label:e.label||"Unknown name"}})),e.next=25;break;case 24:console.error("Media error",i);case 25:return e.next=27,G(O.apiserver+":8806",O.myRoom,O.myUserId,a);case 27:return e.next=29,O.conference.send({action:"publish",room:O.myRoom,display:O.myUserId});case 29:e.sent,r.participants.forEach((function(e){O.users.push({id:e.display,userId:e.display,nackname:e.display==O.myUserId?e.display+"(本人)":e.display,level:e.level,ishand:M(e.display),muteaudio:H(e.display),mutevideo:D(e.display),shareScreenStream:!1}),e.display!==O.myUserId&&e.publishing&&q(O.apiserver+":8806",O.myRoom,e.display)}));case 31:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),O.wsclient.wsmsg.addEventListener("adduserlist",(function(e){e.detail.user_name!==O.myUserId&&O.userlist.push(e.detail)})),O.wsclient.wsmsg.addEventListener("usermute",(function(e){for(var t=0;t<O.users.length;++t)if(O.users[t]&&O.users[t].userId===e.detail.user_name){O.users[t].muteaudio=e.detail.muteaudio,O.users[t].mutevideo=e.detail.mutevideo;break}for(t=0;t<O.userlist.length;++t)if(O.userlist[t]&&O.userlist[t].user_name===e.detail.user_name){O.userlist[t].muteaudio=e.detail.muteaudio,O.userlist[t].mutevideo=e.detail.mutevideo;break}e.detail.user_name==O.myUserId&&(O.muteVideo=e.detail.mutevideo,O.muteAudio=e.detail.muteaudio,s["b"].emit("updateStream"))})),O.wsclient.wsmsg.addEventListener("userhand",(function(e){for(var t=0;t<O.users.length;++t)if(O.users[t]&&O.users[t].userId===e.detail.user_name){O.users[t].ishand=e.detail.ishand;break}for(t=0;t<O.userlist.length;++t)if(O.userlist[t]&&O.userlist[t].user_name===e.detail.user_name){O.userlist[t].ishand=e.detail.ishand;break}e.detail.user_name==O.myUserId&&(O.ishand=e.detail.ishand)})),O.wsclient.wsmsg.addEventListener("get_top_list",(function(e){for(var t=0;t<e.detail.top_list.length;t++){var r=e.detail.top_list[t];r.opId}})),O.wsclient.wsmsg.addEventListener("set_topfile",(function(e){var t=e.detail;"OPEN"==t.optype&&(O.openfileurl=t.topfile,O.pageNum=parseInt(t.topfilepage)),t.optype,"PageNum"==t.optype&&(""==O.openfileurl?(O.openfileurl=t.topfile,O.pageNum=parseInt(t.topfilepage)):O.pageNum=parseInt(t.topfilepage))})),O.wsclient.wsmsg.addEventListener("draw_message",(function(e){e.detail.opId})),O.wsclient.wsmsg.addEventListener("disconnect",(function(e){var t=0;console.log("disconnect->",e.detail);for(var r=0;r<O.userlist.length;++r)if(O.userlist[r]&&O.userlist[r].user_name===e.detail.user_name){t=r,O.userlist.splice(t,1);break}e.detail.user_name==O.myUserId&&$()}))}var G=function(e,t,r,n){var a="webrtc://"+e+"/"+t+"/"+r;return O.publicationGlobal&&O.publicationGlobal.close(),O.localStream=n,O.localStream.getVideoTracks()[0].enabled=!O.muteVideo,O.localStream.getAudioTracks()[0].enabled=!O.muteAudio,O.publicationGlobal=new i,O.publicationGlobal.publish(a,n).then((function(e){})).catch((function(e){O.publicationGlobal.close(),console.error(e)}))},q=function(e,t,r){var n=new c,a="webrtc://"+e+"/"+t+"/"+r,s={};s.remote=r,s.stream=null,s.mutevideo=!0,s.player=n,s.userId=r,s.fingerprint=r,O.peers.push(s),n.onaddstream=function(e){s.stream=e.stream},n.play(a).then((function(e){})).catch((function(e){L(r),console.error(e)}))};function W(e){return B.apply(this,arguments)}function B(){return B=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:O.isDesktopShared?O.deviceVideo=null:O.deviceVideo="desktop";case 1:case"end":return e.stop()}}),e)}))),B.apply(this,arguments)}function J(){if(O.sipserver)if(O.isRecordStarted){Object(u["i"])(O.sipserver,(function(){}),"https://"+O.apiserver+":8806"),O.isRecordStarted=!1;var e={type:"msg_text"};e.content="直播推流:"+O.sipserver+"停止！",e.userId=O.myUserId,s["b"].emit("sendMessage",e)}else{var t="rtmp://127.0.0.1:1937/"+O.myRoom+"/"+O.myUserId,r=O.myUserId,n="RRTMP";Object(u["g"])(t,r,O.sipserver,n,(function(){}),"https://"+O.apiserver+":8806"),O.isRecordStarted=!0;var a={type:"msg_text"};a.content="直播推流:"+O.sipserver+"开始！",a.userId=O.myUserId,s["b"].emit("sendMessage",a)}else alert("推流地址不能为空！")}function F(){O.localStream&&z(O.localStream),O.localStream=null;try{O.publicationGlobal&&O.publicationGlobal.close(),O.publicationGlobal=null}catch(e){}}function z(e){if(e)try{e.getTracks().forEach((function(t){t.stop(),e.removeTrack(t)})),e=null}catch(t){console.error(t)}finally{e=null}}function $(e){O.isRecordStarted&&Object(u["i"])(O.sipserver,(function(){}),"https://"+O.apiserver+":8806"),O.conference&&O.conference.close(),O.conference=null,O.localStream&&O.localStream&&z(O.localStream),O.localStream=null,O.publicationGlobal&&O.publicationGlobal.close(),O.publicationGlobal=null,O.wsclient&&O.wsclient.disconnect(),O.wsclient=null;for(var t=0;t<O.peers.length;++t)O.peers[t].player.close();O.ScreenStream&&O.ScreenStream&&z(O.ScreenStream),O.ScreenStream=null,O.mixStreamGlobal&&O.mixStreamGlobal&&z(O.mixStreamGlobal),O.mixStreamGlobal=null,O.publicationGlobalSecond&&O.publicationGlobalSecond.close(),O.publicationGlobalSecond=null,O.publicationScreenGlobal&&O.publicationScreenGlobal.close(),O.publicationScreenGlobal=null,location.href="./login.html",O.playerStream=null,O.statInterval&&(clearInterval(O.statInterval),O.statInterval=0),O.refreshMute&&(clearInterval(O.refreshMute),O.refreshMute=0)}window.opmessageSend=function(e){var t=new Date,r=t.getTime();e.type="draw_message",e.opId="canvas",e.opTime=r+"",e.userName=O.myUserId,O.wsclient.send(e)},window.fileMsgSend=function(e,t){var r={topfile:O.openfileurl,type:"set_topfile",optype:e,user_name:O.myUserId,topfilepage:t};O.wsclient.send(r)},window.closeWbbFile=function(e){O.openfileurl==e&&fileMsgSend("RESET","")},window.openWbbFile=function(e){O.wsclient.send(e)},window.setVideoLayout=function(e){console.log(e),O.mixStreamGlobal&&Object(u["d"])(O.myRoomId,O.mixStreamGlobal.id,e)},window.setActiveLayout=function(e){Object(u["c"])(O.myRoomId,e,O.mixStreamGlobal.id)},window.shareVideo=function(e,t,r,n,a){var s="rtmp://127.0.0.1:1937/"+n+"/"+a;Object(u["g"])(e,t,s,r,(function(e){console.log("startLiveUrl->",e),Object(u["h"])(n,a,"https://"+O.apiserver+":8806")}),"https://"+O.apiserver+":8806")},window.closeshareVideo=function(e,t){var r="rtmp://127.0.0.1:1937/"+e+"/"+t;Object(u["j"])(e,t,"https://"+O.apiserver+":8806"),Object(u["i"])(r,(function(){}),"https://"+O.apiserver+":8806")},s["b"].on("desktopShared",W),s["b"].on("liveRecord",J),s["b"].on("closeStream",F),s["b"].on("exitRoom",$),window.onunload=function(e){$(e)},window.onbeforeunload=function(e){$(e)},window.addEventListener("popstate",(function(e){alert("确认退出会议！"),$(e)}),!1)}});
//# sourceMappingURL=index.15b92d1d.js.map